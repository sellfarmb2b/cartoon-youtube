# 성능 최적화 방안

## 현재 설정 분석

- **MAX_SCENE_WORKERS**: 4 (이미지/TTS 병렬 처리)
- **OPENAI_PROMPT_BATCH_SIZE**: 12
- **OPENAI_PROMPT_WORKERS**: 2
- **SCRIPT_CHUNK_MAX_SENTENCES**: 80

## 최적화 방안

### 1. 병렬 워커 수 증가 (즉시 적용 가능)

**현재**: MAX_SCENE_WORKERS = 4
**권장**: MAX_SCENE_WORKERS = 8-12

**효과**: 이미지/TTS 생성 시간 50-70% 단축
**주의사항**: API rate limit 확인 필요

### 2. OpenAI 프롬프트 배치 크기 최적화

**현재**: OPENAI_PROMPT_BATCH_SIZE = 12, OPENAI_PROMPT_WORKERS = 2
**권장**: 
- OPENAI_PROMPT_BATCH_SIZE = 20 (더 큰 배치)
- OPENAI_PROMPT_WORKERS = 3-4 (더 많은 병렬 처리)

**효과**: 프롬프트 생성 시간 30-40% 단축
**주의사항**: JSON 파싱 오류 가능성 증가 (재시도 로직으로 보완)

### 3. 더 빠른 이미지 생성 모델 사용

**현재**: 
- 애니메이션: leonardoai/lucid-origin (10-20초)
- 실사화: adirik/realvisxl-v3.0-turbo (15-30초)

**대안**:
- 애니메이션: 더 빠른 모델 탐색 (5-10초 목표)
- 실사화: turbo 모델 유지 (이미 최적화됨)

**효과**: 이미지 생성 시간 50% 단축 가능

### 4. 청크 분할 최적화

**현재**: SCRIPT_CHUNK_MAX_SENTENCES = 80
**권장**: SCRIPT_CHUNK_MAX_SENTENCES = 100-120

**효과**: 
- 청크 수 감소 → 최종 합치기 시간 단축
- 각 청크가 더 효율적으로 처리

**주의사항**: 청크가 너무 크면 메모리 사용량 증가

### 5. 비동기 처리 개선

**현재**: ThreadPoolExecutor 사용
**개선**: 
- 이미지 생성과 TTS 생성을 완전히 병렬화
- 프롬프트 생성 완료 전에 이미지 생성 시작 가능하도록

**효과**: 전체 처리 시간 20-30% 단축

### 6. FFmpeg 렌더링 최적화

**현재**: 기본 설정
**개선**:
- 하드웨어 가속 사용 (가능한 경우)
- 프리셋 최적화
- 멀티스레딩 활용

**효과**: 비디오 합성 시간 30-50% 단축

### 7. 캐싱 전략

**제안**:
- 동일한 문장의 프롬프트 캐싱
- 이미 생성된 이미지 재사용 (선택적)

**효과**: 반복 작업 시 시간 대폭 단축

### 8. API 호출 최적화

**개선**:
- 연결 풀링
- 타임아웃 최적화
- 재시도 전략 개선

**효과**: 네트워크 오버헤드 감소

## 우선순위별 적용 계획

### 즉시 적용 (High Priority)
1. ✅ 병렬 워커 수 증가 (MAX_SCENE_WORKERS: 4 → 8)
2. ✅ OpenAI 워커 수 증가 (OPENAI_PROMPT_WORKERS: 2 → 4)
3. ✅ 청크 크기 증가 (SCRIPT_CHUNK_MAX_SENTENCES: 80 → 100)

### 단기 적용 (Medium Priority)
4. 비동기 처리 개선
5. FFmpeg 최적화

### 장기 적용 (Low Priority)
6. 캐싱 전략
7. 더 빠른 모델 탐색

## 예상 성능 개선

### 6700자 대본 기준

**현재 예상 시간**:
- 애니메이션: 15-17분
- 실사화: 18-20분

**최적화 후 예상 시간**:
- 애니메이션: **8-10분** (약 40-50% 단축)
- 실사화: **10-12분** (약 40-45% 단축)

## 구현 방법

각 최적화 항목은 코드 수정으로 즉시 적용 가능합니다.

